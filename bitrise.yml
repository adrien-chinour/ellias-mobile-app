---
format_version: '8'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other
app:
    envs:
        -   default_apk_dir: "./app/build/outputs/apk"
        -   default_apk_name: app-debug.apk
workflows:
    _ci_setup:
        steps:
            -   activate-ssh-key@4:
                    run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
            -   git-clone@4: { }
            -   script@1.1.3:
                    title: Build the app for distribution
                    inputs:
                        -   content: |-
                                #!/bin/bash
                                set -ex
                                #
                                npm install
                                npm install -g @ionic/cli
                                ionic cap sync
    _ci_finish:
        steps:
            -   deploy-to-bitrise-io@1.2.6:
                    run_if: '{{getenv "BITRISE_BUILD_URL" | ne ""}}'
    build-android:
        steps:
            -   script@1:
                    title: gradlew
                    inputs:
                        -   content: |-
                                #!/bin/bash
                                set -ex
                                cd android
                                bash ./gradlew assemble
            -   script@1:
                    title: gradle assemble & move to DEPLOY dir
                    inputs:
                        -   content: |-
                                #!/bin/bash
                                set -ex
                                cd android
                                gradle assemble
                                mv "${default_apk_dir}/${default_apk_name}" "${BITRISE_DEPLOY_DIR}/${default_apk_name}"
            -   bitrise-artifact-deploy@1:
                    inputs:
                        -   is_compress: 'false'
    build-ios:
        steps:

    ci-ios:
        before_run:
            - _ci_setup
        after_run:
            - build-ios
            - _ci_finish
    ci-android:
        before_run:
            - _ci_setup
        after_run:
            - build-android
            - _ci_finish
